amlModuleIdentifier:
  namespace: css
  moduleName: Semantic Textual Similarity
  description: Compute semantic similary matrix of text corpus using sentence transformers .
  moduleVersion: 0.0.1
description: >
    Compute semantic similary matrix of text corpus using Siasmese transformers networks .
    https://arxiv.org/abs/1908.10084 

    This module requires GPU compute.
isdeterministric: true
metadata:
  annotations:
    tags:
    - Feature Engineering
    - Sentence Embeddings
    - Text Classification
    sourceCode: https://github.com/azure/amlmodules
    contact: Yassine khelifi <yassinek@microsoft.com>
inputs:
- name: Input dataset
  type: DataFrameDirectory
  port: true
- name: Target column
  type: string
  description: Select target column
- name: Pretrained sentence Bert
  type: Mode
  default: bert-base
  options: 
  - bert-base
  - bert-large
  - roberta-base
  - roberta-large
  - distilbert-base
- name: Distance
  type: Mode
  default: cosine
  options: 
  - cosine
  - euclidean
  - manhattan
outputs:
- name: Similarity matrix
  type: DataFrameDirectory
  port: true
- name: Embeddings
  type: DataFrameDirectory
  port: true
implementation:
  container:
    conda: sts_conda.yaml
    image: mcr.microsoft.com/azureml/base-gpu:intelmpi2018.3-cuda10.0-cudnn7-ubuntu16.04
    additionalIncludes: 
      - ../sts_module.py
      - ../sts.py
    command: [python, sts_module.py] 
    args: [
        --input-dir, {inputPath: Input dataset},
        --column-name, {inputValue: Target column},
        --transformer, {inputValue: Pretrained sentence Bert},
        --distance, {inputValue: Distance}, 
        --sim-dir, {outputPath: Similarity matrix},
        --embedding-dir,{outputPath: Embeddings}] 